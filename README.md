# cathaybank
國泰世華 JAVA engineer 線上作業

首頁 http://localhost:8888/

SQL語法如下

  DROP TABLE IF EXISTS CURRENCY_MAPPER;

  CREATE TABLE CURRENCY_MAPPER

  (

  id INTEGER auto_increment,

  CURRENCY_CODE varchar2 UNIQUE,

  CURRENCY_NAME varchar2 UNIQUE

  );

comment on table CURRENCY_MAPPER is '幣別對照表';

comment on column CURRENCY_MAPPER.id is '主鍵';

comment on column CURRENCY_MAPPER.CURRENCY_CODE is '幣別代碼';

comment on column CURRENCY_MAPPER.CURRENCY_NAME is '幣別中文';

INSERT INTO CURRENCY_MAPPER (CURRENCY_CODE, CURRENCY_NAME) VALUES ('USD', '美元');

INSERT INTO CURRENCY_MAPPER (CURRENCY_CODE, CURRENCY_NAME) VALUES ('GBP', '英鎊');

INSERT INTO CURRENCY_MAPPER (CURRENCY_CODE, CURRENCY_NAME) VALUES ('EUR', '歐元');




  CREATE TABLE "DBUSERNEB"."COMPANY" 
   (	"COMPANY_KEY" NUMBER(9,0) NOT NULL ENABLE, 
	"COMPANY_UID" VARCHAR2(64 BYTE), 
	"UID_DUP" VARCHAR2(1 BYTE), 
	"STATUS" NUMBER(1,0), 
	"COMPANY_KIND" NUMBER(2,0), 
	"COMPANY_BU_TYPE" NUMBER(1,0), 
	"COMPANY_NAME" NVARCHAR2(256), 
	"COMPANY_ENAME" VARCHAR2(256 BYTE), 
	"UAA_LEVEL" NUMBER(1,0), 
	"DEFAULT_FLOW_SCHEMA_KEY" NUMBER(9,0), 
	"SCHEMA_SUIT_OPERATOR_KEY" NUMBER(9,0), 
	"SCHEMA_SUIT_CREATE_TIME" TIMESTAMP (6), 
	"ESTABLISH_DATE" DATE, 
	"DEFAULT_BRANCH_ID" VARCHAR2(4 BYTE), 
	"TEL" VARCHAR2(20 BYTE), 
	"FAX" VARCHAR2(16 BYTE), 
	"MOBILE" VARCHAR2(20 BYTE), 
	"EMAILS" VARCHAR2(256 BYTE), 
	"RETRY_FLAG" NUMBER(1,0), 
	"LOGIN_FLAG" NUMBER(1,0), 
	"SALARY_FLAG" NUMBER(1,0), 
	"ONLINE_PAYEE_FLAG" NUMBER(1,0), 
	"ROOT1_TX_FLAG" NUMBER(1,0), 
	"ROOT2_TX_FLAG" NUMBER(1,0), 
	"PAYER_ACCOUNT_FLAG" NUMBER(1,0), 
	"PAYEE_ACCOUNT_FLAG" NUMBER(1,0), 
	"FAX_FLAG" NUMBER(1,0), 
	"TW_ATM_FLAG" NUMBER(1,0), 
	"TW_REMIT_FLAG" NUMBER(1,0), 
	"TW_FXML_FLAG" NUMBER(1,0), 
	"TW_PAYEE_FLAG" NUMBER(1,0), 
	"TW_AMT_QUOTA" NUMBER(15,2), 
	"TW_INTER_REMIT_QUOTA" NUMBER(15,2), 
	"REGISTER_TIME" TIMESTAMP (6), 
	"CANCEL_TIME" TIMESTAMP (6), 
	"LAST_BRANCH_ID" VARCHAR2(4 BYTE), 
	"LAST_EDITOR_KEY" NUMBER(9,0), 
	"LAST_MANAGER_KEY" NUMBER(9,0), 
	"LAST_UPDATE_TIME" TIMESTAMP (6), 
	"QUERY_ONLY_FLAG" NUMBER(1,0), 
	"KYC_REVALIDATED" NUMBER(1,0), 
	"KYC_REVALIDATED_DATE" TIMESTAMP (6), 
	"MASS_CHECK" VARCHAR2(2 BYTE), 
	"CUSTOM_AUDIT_ID" VARCHAR2(32 BYTE), 
	"UPDATE_DAY" DATE DEFAULT to_date('20240929','yyyymmdd')
   ) 
   COMMENT ON COLUMN "DBUSERNEB"."COMPANY"."COMPANY_KEY" IS '公司鍵值
IDENTITY';
   COMMENT ON COLUMN "DBUSERNEB"."COMPANY"."COMPANY_UID" IS '公司統編
登入的統編或身份證字號
註銷時：加上三碼註銷碼（NN_：NN表示客戶第幾次注銷）';
   COMMENT ON COLUMN "DBUSERNEB"."COMPANY"."UID_DUP" IS '誤別碼';
   COMMENT ON COLUMN "DBUSERNEB"."COMPANY"."STATUS" IS '公司狀態
1：正常
0：暫停
-1：註銷
-2：虛擬公司（未申請網銀的關係戶）';
   COMMENT ON COLUMN "DBUSERNEB"."COMPANY"."COMPANY_KIND" IS '公司類型
1: 企業戶
2: 個人戶';
   COMMENT ON COLUMN "DBUSERNEB"."COMPANY"."COMPANY_BU_TYPE" IS '公司BU類型
1：DBU
2：OBU
-9 : 未知 (需發電文 EB12020004 取得)';
   COMMENT ON COLUMN "DBUSERNEB"."COMPANY"."COMPANY_NAME" IS '公司戶名';
   COMMENT ON COLUMN "DBUSERNEB"."COMPANY"."COMPANY_ENAME" IS '公司英文名稱';
   COMMENT ON COLUMN "DBUSERNEB"."COMPANY"."UAA_LEVEL" IS '申請的授權中心類別
0：無授權中心功能
1：單層授權
2：兩層式授權';
   COMMENT ON COLUMN "DBUSERNEB"."COMPANY"."DEFAULT_FLOW_SCHEMA_KEY" IS '公司預設流程鍵值
FLOW_SCHEMA.FLOWSCHEMA_KEY
0：無預設流程';
   COMMENT ON COLUMN "DBUSERNEB"."COMPANY"."SCHEMA_SUIT_OPERATOR_KEY" IS '流程套餐設定人員鍵值
0：尚未設定流程套餐(default)';
   COMMENT ON COLUMN "DBUSERNEB"."COMPANY"."SCHEMA_SUIT_CREATE_TIME" IS '流程套餐設定時間';
   COMMENT ON COLUMN "DBUSERNEB"."COMPANY"."ESTABLISH_DATE" IS '公司創立日期或個人出生日期';
   COMMENT ON COLUMN "DBUSERNEB"."COMPANY"."DEFAULT_BRANCH_ID" IS '往來分行代碼';
   COMMENT ON COLUMN "DBUSERNEB"."COMPANY"."TEL" IS '聯絡電話';
   COMMENT ON COLUMN "DBUSERNEB"."COMPANY"."FAX" IS '傳真電話';
   COMMENT ON COLUMN "DBUSERNEB"."COMPANY"."MOBILE" IS '行動電話';
   COMMENT ON COLUMN "DBUSERNEB"."COMPANY"."EMAILS" IS 'Email Address
(以分號;分隔多筆)';
   COMMENT ON COLUMN "DBUSERNEB"."COMPANY"."RETRY_FLAG" IS '啟用餘額不足重試扣款
0：否
1：是';
   COMMENT ON COLUMN "DBUSERNEB"."COMPANY"."LOGIN_FLAG" IS '是否啟用雙重登入認證
0：否
1：是';
   COMMENT ON COLUMN "DBUSERNEB"."COMPANY"."SALARY_FLAG" IS '是否啟用電子薪資單服務
0：否
1：是';
   COMMENT ON COLUMN "DBUSERNEB"."COMPANY"."ONLINE_PAYEE_FLAG" IS '是否啟用線上約定收款人
0：否
2：是';
   COMMENT ON COLUMN "DBUSERNEB"."COMPANY"."ROOT1_TX_FLAG" IS '授權管理者是否兼具交易權限
0：否
3：是';
   COMMENT ON COLUMN "DBUSERNEB"."COMPANY"."ROOT2_TX_FLAG" IS '授權主管是否兼具交易權限
0：否
4：是';
   COMMENT ON COLUMN "DBUSERNEB"."COMPANY"."PAYER_ACCOUNT_FLAG" IS '所有存款（歸戶）帳號均視為約定轉出帳號（包含未來新開立的帳號）
0：否
5：是';
   COMMENT ON COLUMN "DBUSERNEB"."COMPANY"."PAYEE_ACCOUNT_FLAG" IS '所有轉出帳號均視為約定轉入帳號（包含未來新約定的轉出帳號）
0：否
6：是';
   COMMENT ON COLUMN "DBUSERNEB"."COMPANY"."FAX_FLAG" IS '否啟用傳真服務
0：否
7：是';
   COMMENT ON COLUMN "DBUSERNEB"."COMPANY"."TW_ATM_FLAG" IS '是否啟用ATM轉帳';
   COMMENT ON COLUMN "DBUSERNEB"."COMPANY"."TW_REMIT_FLAG" IS '是否啟用通匯轉帳';
   COMMENT ON COLUMN "DBUSERNEB"."COMPANY"."TW_FXML_FLAG" IS '是否啟用FXML轉帳';
   COMMENT ON COLUMN "DBUSERNEB"."COMPANY"."TW_PAYEE_FLAG" IS '轉入帳號是否限常用收款人';
   COMMENT ON COLUMN "DBUSERNEB"."COMPANY"."TW_AMT_QUOTA" IS 'ATM付款金額上限（元）';
   COMMENT ON COLUMN "DBUSERNEB"."COMPANY"."TW_INTER_REMIT_QUOTA" IS '跨行通匯付款金額上限（元）';
   COMMENT ON COLUMN "DBUSERNEB"."COMPANY"."REGISTER_TIME" IS '申請時間';
   COMMENT ON COLUMN "DBUSERNEB"."COMPANY"."CANCEL_TIME" IS '網銀帳戶註銷時間';
   COMMENT ON COLUMN "DBUSERNEB"."COMPANY"."LAST_BRANCH_ID" IS '最後更新分行代碼';
   COMMENT ON COLUMN "DBUSERNEB"."COMPANY"."LAST_EDITOR_KEY" IS '最後更新經辦鍵值';
   COMMENT ON COLUMN "DBUSERNEB"."COMPANY"."LAST_MANAGER_KEY" IS '最後更新主管鍵值';
   COMMENT ON COLUMN "DBUSERNEB"."COMPANY"."LAST_UPDATE_TIME" IS '最後異動時間';
   COMMENT ON COLUMN "DBUSERNEB"."COMPANY"."QUERY_ONLY_FLAG" IS '申請功能限查詢
1：不能勾選申辦業務子系統';
   COMMENT ON COLUMN "DBUSERNEB"."COMPANY"."KYC_REVALIDATED" IS '是否已重做KYC';
   COMMENT ON COLUMN "DBUSERNEB"."COMPANY"."KYC_REVALIDATED_DATE" IS 'KYC重做時間';
   COMMENT ON COLUMN "DBUSERNEB"."COMPANY"."MASS_CHECK" IS 'TFB 客群代碼';
   COMMENT ON COLUMN "DBUSERNEB"."COMPANY"."CUSTOM_AUDIT_ID" IS '交易被授權人身分證字號';
   COMMENT ON COLUMN "DBUSERNEB"."COMPANY"."UPDATE_DAY" IS '系統時間';
   COMMENT ON TABLE "DBUSERNEB"."COMPANY"  IS '公司基本資料';




  CREATE TABLE "DBUSERNEB"."EB_LOGIN_LOG_B" 
   (	"LOGIN_LOG_KEY" NUMBER(9,0) NOT NULL ENABLE, 
	"COMPANY_KEY" NUMBER(9,0), 
	"USER_KEY" NUMBER(9,0), 
	"USER_UUID" VARCHAR2(32 BYTE), 
	"CLIENT_IP" VARCHAR2(45 BYTE), 
	"LOGIN_TIME" TIMESTAMP (6) DEFAULT sysdate, 
	"LOGOUT_TIME" TIMESTAMP (6), 
	"ERROR_SYSTEM_ID" VARCHAR2(10 BYTE), 
	"ERROR_CODE" VARCHAR2(8 BYTE), 
	"ERROR_DESC" NVARCHAR2(256), 
	"START_IP" VARCHAR2(15 BYTE), 
	"END_IP" VARCHAR2(15 BYTE), 
	"NATION_CODE" VARCHAR2(2 BYTE), 
	"NATION_NAME" NVARCHAR2(20), 
	"USER_AGENT" NVARCHAR2(1000), 
	"SCREEN_WIDTH" NUMBER(5,0), 
	"SCREEN_HEIGHT" NUMBER(5,0), 
	"SIGNON_TOKEN" VARCHAR2(100 BYTE), 
	"SERVER_ID" VARCHAR2(16 BYTE), 
	"NAME_CODE" VARCHAR2(4 BYTE), 
	"SESSION_ID" VARCHAR2(64 BYTE), 
	"CITY_NAME" VARCHAR2(256 BYTE), 
	"LOCATION_ID" NUMBER(9,0), 
	"CHANNEL_ID" VARCHAR2(1 BYTE), 
	"COMPANY_UID" VARCHAR2(64 BYTE), 
	"UID_DUP" VARCHAR2(1 BYTE)
   ) 

   COMMENT ON COLUMN "DBUSERNEB"."EB_LOGIN_LOG_B"."LOGIN_LOG_KEY" IS '登入記錄鍵值Reference to SEQ_EB_LOGIN_LOG_B_KEY';
   COMMENT ON COLUMN "DBUSERNEB"."EB_LOGIN_LOG_B"."COMPANY_KEY" IS '公司鍵值0：表示查無登入統編';
   COMMENT ON COLUMN "DBUSERNEB"."EB_LOGIN_LOG_B"."USER_KEY" IS '使用者鍵值0：表示查無登入使用者';
   COMMENT ON COLUMN "DBUSERNEB"."EB_LOGIN_LOG_B"."USER_UUID" IS '登入時的使用者代號';
   COMMENT ON COLUMN "DBUSERNEB"."EB_LOGIN_LOG_B"."CLIENT_IP" IS '登入IP';
   COMMENT ON COLUMN "DBUSERNEB"."EB_LOGIN_LOG_B"."LOGIN_TIME" IS '登入時間';
   COMMENT ON COLUMN "DBUSERNEB"."EB_LOGIN_LOG_B"."LOGOUT_TIME" IS '登出時間';
   COMMENT ON COLUMN "DBUSERNEB"."EB_LOGIN_LOG_B"."ERROR_SYSTEM_ID" IS '錯誤系統代碼';
   COMMENT ON COLUMN "DBUSERNEB"."EB_LOGIN_LOG_B"."ERROR_CODE" IS '錯誤代碼';
   COMMENT ON COLUMN "DBUSERNEB"."EB_LOGIN_LOG_B"."ERROR_DESC" IS '錯誤訊息描述';
   COMMENT ON COLUMN "DBUSERNEB"."EB_LOGIN_LOG_B"."START_IP" IS '起始IP';
   COMMENT ON COLUMN "DBUSERNEB"."EB_LOGIN_LOG_B"."END_IP" IS '結束IP';
   COMMENT ON COLUMN "DBUSERNEB"."EB_LOGIN_LOG_B"."NATION_CODE" IS '國別代碼2碼';
   COMMENT ON COLUMN "DBUSERNEB"."EB_LOGIN_LOG_B"."NATION_NAME" IS '國別中文';
   COMMENT ON COLUMN "DBUSERNEB"."EB_LOGIN_LOG_B"."USER_AGENT" IS '記錄UserAgent以分析使用者使用瀏覽器、OS';
   COMMENT ON COLUMN "DBUSERNEB"."EB_LOGIN_LOG_B"."SCREEN_WIDTH" IS '記錄SCREEN WIDTH';
   COMMENT ON COLUMN "DBUSERNEB"."EB_LOGIN_LOG_B"."SCREEN_HEIGHT" IS '記錄SCREEN HEIGHT';
   COMMENT ON COLUMN "DBUSERNEB"."EB_LOGIN_LOG_B"."SIGNON_TOKEN" IS '登入Token, 用於判斷使用者重覆登入(同一session登入第二次)';
   COMMENT ON COLUMN "DBUSERNEB"."EB_LOGIN_LOG_B"."SERVER_ID" IS 'AP server host name';
   COMMENT ON COLUMN "DBUSERNEB"."EB_LOGIN_LOG_B"."NAME_CODE" IS '登入時的 name code';
   COMMENT ON COLUMN "DBUSERNEB"."EB_LOGIN_LOG_B"."SESSION_ID" IS 'Session Id';
   COMMENT ON COLUMN "DBUSERNEB"."EB_LOGIN_LOG_B"."CITY_NAME" IS '城市名稱';
   COMMENT ON COLUMN "DBUSERNEB"."EB_LOGIN_LOG_B"."LOCATION_ID" IS 'GEO IP Location ID';




   -- 1. 近三個月使用兩種身分登入會員客戶ID(不重複)
-- 找出同時擁有企業/個人戶和信用卡身份，並且近三個月內兩種身份都有登入的客戶
SELECT DISTINCT
    c.COMPANY_KEY,
    c.COMPANY_UID,
    c.COMPANY_KIND
FROM 
    COMPANY c
WHERE 
    -- 確保客戶同時擁有企業/個人戶和信用卡身份
    c.COMPANY_UID IN (
        SELECT 
            COMPANY_UID 
        FROM 
            COMPANY
        GROUP BY 
            COMPANY_UID 
        HAVING 
            MAX(CASE WHEN COMPANY_KIND IN(1, 2) THEN 1 ELSE 0 END) = 1 
            AND MAX(CASE WHEN COMPANY_KIND IN(3, 4) THEN 1 ELSE 0 END) = 1
    )
    AND EXISTS (
        -- 近三個月有使用企業/個人戶身份登入
        SELECT 1
        FROM COMPANY c1
        JOIN eb_login_log_b_bak l1 ON c1.COMPANY_KEY = l1.COMPANY_KEY
        WHERE c1.COMPANY_UID = c.COMPANY_UID
        AND c1.COMPANY_KIND IN (1, 2)
        AND l1.LOGIN_TIME >= ADD_MONTHS(SYSDATE, -3)
    )
    AND EXISTS (
        -- 近三個月有使用信用卡身份登入
        SELECT 1
        FROM COMPANY c2
        JOIN eb_login_log_b_bak l2 ON c2.COMPANY_KEY = l2.COMPANY_KEY
        WHERE c2.COMPANY_UID = c.COMPANY_UID
        AND c2.COMPANY_KIND IN (3, 4)
        AND l2.LOGIN_TIME >= ADD_MONTHS(SYSDATE, -3)
    );

-- 2. 近三個月僅使用信用卡會員身分登入的ID(不重複)
-- 找出同時擁有企業/個人戶和信用卡身份，但近三個月只使用信用卡身份登入的客戶
SELECT DISTINCT
    c.COMPANY_KEY,
    c.COMPANY_UID,
    c.COMPANY_KIND
FROM 
    COMPANY c
WHERE 
    c.COMPANY_KIND IN (3, 4)  -- 只選取信用卡身份的記錄
    -- 確保客戶同時擁有企業/個人戶和信用卡身份
    AND c.COMPANY_UID IN (
        SELECT 
            COMPANY_UID 
        FROM 
            COMPANY
        GROUP BY 
            COMPANY_UID 
        HAVING 
            MAX(CASE WHEN COMPANY_KIND IN(1, 2) THEN 1 ELSE 0 END) = 1 
            AND MAX(CASE WHEN COMPANY_KIND IN(3, 4) THEN 1 ELSE 0 END) = 1
    )
    -- 確保近三個月有使用信用卡身份登入
    AND EXISTS (
        SELECT 1
        FROM eb_login_log_b_bak l
        WHERE l.COMPANY_KEY = c.COMPANY_KEY
        AND l.LOGIN_TIME >= ADD_MONTHS(SYSDATE, -3)
    )
    -- 確保近三個月未使用企業/個人戶身份登入
    AND NOT EXISTS (
        SELECT 1
        FROM COMPANY c2
        JOIN eb_login_log_b_bak l2 ON c2.COMPANY_KEY = l2.COMPANY_KEY
        WHERE c2.COMPANY_UID = c.COMPANY_UID
        AND c2.COMPANY_KIND IN (1, 2)
        AND l2.LOGIN_TIME >= ADD_MONTHS(SYSDATE, -3)
    );

-- 3. 近六個月未登入Fubon+客戶ID(不重複)
-- 找出同時擁有企業/個人戶和信用卡身份，但近六個月未通過Fubon+登入的客戶
SELECT DISTINCT
    c.COMPANY_UID
FROM 
    COMPANY c
WHERE 
    -- 確保客戶同時擁有企業/個人戶和信用卡身份
    c.COMPANY_UID IN (
        SELECT 
            COMPANY_UID 
        FROM 
            COMPANY
        GROUP BY 
            COMPANY_UID 
        HAVING 
            MAX(CASE WHEN COMPANY_KIND IN(1, 2) THEN 1 ELSE 0 END) = 1 
            AND MAX(CASE WHEN COMPANY_KIND IN(3, 4) THEN 1 ELSE 0 END) = 1
    )
    -- 確保近六個月未通過Fubon+(CHANNEL_ID='M')登入
    AND NOT EXISTS (
        SELECT 1
        FROM eb_login_log_b_bak l
        WHERE l.COMPANY_KEY = c.COMPANY_KEY
        AND l.CHANNEL_ID = 'M'  -- Fubon+通路
        AND l.LOGIN_TIME >= ADD_MONTHS(SYSDATE, -6)
    );
   COMMENT ON COLUMN "DBUSERNEB"."EB_LOGIN_LOG_B"."CHANNEL_ID" IS '通路0：網銀1：網路ATM2：媒體薪轉3：e化繳費網4：行銀5：信用卡會員6：員工持股儲蓄信託7：員工分紅認股信託FINI保管專區';
   COMMENT ON COLUMN "DBUSERNEB"."EB_LOGIN_LOG_B"."COMPANY_UID" IS '公司統編';
   COMMENT ON COLUMN "DBUSERNEB"."EB_LOGIN_LOG_B"."UID_DUP" IS '誤別碼';
   COMMENT ON TABLE "DBUSERNEB"."EB_LOGIN_LOG_B"  IS '登入記錄';


